# next-react-query-tailwind

This demo application is a small re-implementation of some GitHub pages / functionality built using their GraphQL API.

Amplify URL: https://main.d31pj5m17ne70k.amplifyapp.com

## Table of Contents

- [Overview](#overview)
  - [Featured Tech Stack](#featured-tech-stack)
  - [Included Tooling](#included-tooling)
  - [Demo Application Libraries](#demo-application-libraries)
- [Getting Started](#getting-started)
  - [Downloading](#downloading)
  - [Installation](#installation)
  - [Generated Files](#generated-files)
- [Configuration](#configuration)
  - [Environment Variables](#environment-variables)
  - [OAuth Setup](#oauth-setup)
  - [JWT Encryption Keys](#jwt-encryption-keys)
- [Development](#development)
- [Deployment](#deployment)

## Overview

### Featured Tech Stack

- [GraphQL](https://graphql.org/)
- [Next.js](https://nextjs.org)
- [React](https://reactjs.org)
- [React Query](https://react-query.tanstack.com/)
- [Tailwind CSS](https://tailwindcss.com)

### Included Tooling

- [Jest](https://jestjs.io)
- [Storybook](https://storybook.js.org)
- [Mock Service Worker](https://mswjs.io)
- [GraphQL Code Generator](https://www.graphql-code-generator.com/)
- [ESLint](https://eslint.org)
- [Prettier](https://prettier.io)

### Demo Application Libraries

- [Next Auth](https://next-auth.js.org/)
- [GitHub GraphQL API](https://docs.github.com/en/graphql)

## Getting Started

### Downloading

Download or clone the starter.dev-showcases repository from https://github.com/thisdot/starter.dev-showcases

#### Git

```bash
git clone https://github.com/thisdot/starter.dev-showcases.git
```

#### GitHub CLI

```bash
gh repo clone thisdot/starter.dev-showcases
```

### Installation

Open the project root directory in your terminal and navigate to the `next-react-query-tailwind` showcase. Run `yarn` to install the dependencies.

```bash
cd next-react-query-tailwind
yarn
```

### Generated Files

The `src/lib/graphql.ts` file gets generated by `graphql-code-generator` when you run `yarn generate`. This file includes types, queries, and mutations, and `react-query` specific hooks for interacting with the GitHub GraphQL API.

_This gets run automatically before runing `yarn dev` and `yarn build`._

```bash
yarn generate
```

## Configuration

### Environment Variables

The repository comes with an `.env.example` file that includes all the environment variables that are required for the application to run.

- `NEXT_PUBLIC_GRAPHQL_ENDPOINT` - The url to the Next API function that proxies the applications GraphQL requests to the GitHub GraphQL API.
- `NEXTAUTH_URL` - The url for our application used by Next Auth
- `GITHUB_GRAPHQL_ENDPOINT` - The url to the GitHub GraphQL API
- `GITHUB_CLIENT_ID` & `GITHUB_CLIENT_SECRET` - The OAuth credentials for our application auth that need to be setup in GitHub
- `JWT_SECRET` & `JWT_SIGNING_KEY` & `JWT_ENCRYPTION_KEY` - These are generated keys used to encrypt the JWT that gets passed to our graphql proxy endpoint.

### OAuth Setup

To use this app and authenticate with GitHub, we need to setup the OAuth credentials in GitHub.

- Navigation to the [GitHub settings page](https://github.com/settings/profile).
- Click the `Developer settings` link in the sidebar.
- Click the `OAuth Apps` link in the sidebar.
- Click the `New OAuth App` button at the top right of the page.

Register a new OAuth application form details

- Application name - Enter a name for the application
- Homepage URL - Enter the url of the Next application. _(If running locally `http://localhost:3000` otherwise the url of the application on the interenet)_
- Authorization callback URL - Enter the url of the applications oauth callback. _(If running locally `http://localhost:3000` otherwise the url of the Next application)_

After registering your OAuth application, add the generated client id and secret to a `.env` file for the project.

```
GITHUB_CLIENT_ID=xxx
GITHUB_CLIENT_SECRET=xxx
```

### JWT Encryption Keys

There is some pre generated encryption keys provided in the `.env.example` file but if you want to generate new ones this is for reference on how to do it. See: [next-auth #484](https://github.com/nextauthjs/next-auth/issues/484)

#### `JWT_SECRET`

```bash
openssl rand -base64 32
```

#### `JWT_SIGNING_KEY`

```bash
npx node-jose-tools newkey -s 256 -t oct -a HS512
```

#### `JWT_ENCRYPTION_KEY`

```bash
npx node-jose-tools newkey -s 256 -t oct -a A256GCM
```

## Development

Start the development server

```bash
yarn dev
```

Open your browser to [http://localhost:3000](http://localhost:3000)

## Deployment

This demo app gets deployed to AWS Amplify on changes to the `main` branch.

https://main.d31pj5m17ne70k.amplifyapp.com